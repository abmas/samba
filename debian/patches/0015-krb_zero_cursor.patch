From: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
Date: Wed, 24 Feb 2016 13:25:16 -0500
Subject: krb_zero_cursor

===================================================================
---
 source3/librpc/crypto/gse_krb5.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/source3/librpc/crypto/gse_krb5.c b/source3/librpc/crypto/gse_krb5.c
index 3597329..48fe3ca 100644
--- a/source3/librpc/crypto/gse_krb5.c
+++ b/source3/librpc/crypto/gse_krb5.c
@@ -414,6 +414,9 @@ static krb5_error_code fill_mem_keytab_from_system_keytab(krb5_context krbctx,
 	if (ret) {
 		DEBUG(1, (__location__ ": krb5_kt_start_seq_get failed (%s)\n",
 			  error_message(ret)));
+		// if krb5_kt_start_seq_get fails, kt_cursor does not hold any resources,
+		// but might no be "zeroed", (probably containing an invalid fd, see heimdal's keytab_file.c)
+		ZERO_STRUCT(kt_cursor);
 		goto out;
 	}
 
